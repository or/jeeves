{% extends "base.html" %}
{% load static from staticfiles %}
{% block title %}Jeeves - {{ project.name }} - Builds{% endblock %}

{% block content %}
<div class="container-fluid" style="margin:0.2em">
  <h2 class="page-header">{{ project.name }}
      {% if perms.can_edit_project %}
        <a href="{% url 'admin:core_project_change' project.id %}"
           role="button" class="pull-right btn btn-default">
          <span class="glyphicon glyphicon-edit"></span>
        </a>
      {% endif %}
  </h2>

  <div class="row" style="margin:0.2em">
    <div class="panel panel-default col-lg-6">
      <div class="panel-body">
        {{ project.description }}
      </div>
    </div>
    <div class="col-lg-6">
    </div>
  </div>

  {% include "partials/messages.html" with messages=messages %}
  <div id="builds-root"></div>
</div>
{% endblock %}

{% block js %}
</script>
<script type="text/javascript" src="{% static 'jeeves/build-list.js' %}"></script>
<script type="text/javascript">
swampdragon.onChannelMessage(function (channels, message) {
  console.log(channels, message.data);
  if (message.data['change'] == "update") {
    jeeves.core.accept_build(message.data['build']);
  }
  if (message.data['change'] == "delete") {
    jeeves.core.delete_build(message.data['build-id']);
  }
});

swampdragon.ready(function() {
  swampdragon.subscribe('build-changes', 'build-update-json-{{ project.id }}', null);
});

$(function() {
    build_data = {{ all_builds }};
    jeeves.core.accept_builds(build_data);
    jeeves.core.mount_build_list($('#builds-root')[0]);
})
{% endblock %}
